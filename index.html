<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<link rel="icon" href="icon.png">
<title>MetaTrader Jelentés Egyesítő</title>
<style type="text/css">*{font-family:"Arial";color:#DDD;font-size:14px;letter-spacing:0.5px;user-select:none;-moz-user-select:none;-ms-user-select:none}body{margin:0;background-color:#111;overflow-x:hidden;cursor:default}input,textarea{padding:2px;border:1px solid #AAA;border-radius:2px;background-color:#333;transition:0.2s;outline:none;user-select:text;-moz-user-select:text;-ms-user-select:text}input:focus,textarea:focus{border-color:#D62!important;background-color:#111!important}::selection{color:#000;background-color:#DDF}::-moz-selection{color:#000;background-color:#DDF}.button{display:inline-block;border-radius:2px;padding:4px 10px;background-color:rgba(255,255,255,0.2);text-shadow:2px 2px 2px #000;text-align:center;transition:0.3s}.button:hover{background-color:#d63;cursor:pointer;transition:0s}#left_table{float:left;margin:80px 30px 0 30px}#right_table{position:absolute;left:400px;width:560px;padding:40px 0 60px 0}#report_result{width:320px;height:100px;margin-top:10px;resize:none;overflow:hidden}#report_name_table{margin-top:10px;width:326px}#report_name{width:96%;height:100%}#strategies{display:inline-block;width:350px;margin-top:10px;padding-bottom:50px}.remove_buttons:hover{background-color:#D30}.strategy_buttons{width:326px;margin-top:10px;background-color:#333;text-align:center}.strategy_buttons.button{line-height:20px}#page_changer{position:absolute;top:40px;left:30px}.hw{color:#58E}#create_layer{position:absolute;display:none;text-align:center;width:100%;height:100%;background-color:rgba(20,20,20,0.8);z-index:100}#new_list{display:inline-block;margin-top:40vh;color:#d62;font-size:16px;padding:10px 20px;background-color:#111;border:1px solid #AAA}#progress_bar{position:absolute;display:none;height:30px;bottom:0;background-color:#d62;z-index:100}#more_info{height:50px;overflow:hidden}#shadow{position:relative;width:100%;height:1px;box-shadow:0 0 50px 30px rgba(0,0,0,0.5)}#chart_page{position:absolute;display:none;overflow:hidden;width:100%;height:100%;background:url("background.png");background-size:30%;background-repeat:repeat}#chart{border:1px solid #AAA;box-sizing:border-box}.chart_divs{position:absolute;overflow:hidden;top:10px;left:10px;right:10px;bottom:10px}.chart_separators,.chart_years{position:absolute}.chart_separators{border-left:1px dashed #777}.chart_years{padding:2px 5px;color:#AAA}svg{position:absolute}polyline{fill:none;stroke-width:2}circle{stroke:rgba(255,200,0,0.3);fill:rgba(255,220,0,1);stroke-width:10}#dd_rect{display:none;margin-top:-10px;margin-left:-10px}#dd_rect rect{fill:rgba(255,100,50,0.2);stroke:rgba(255,0,0,0.4);stroke-width:2}#zoom_rect{display:none;width:0px;margin-top:-10px;margin-left:-10px}#zoom_rect rect{fill:rgba(200,200,200,0.2);stroke:#AAA;stroke-width:2}.tabs{position:absolute;display:none;background-color:rgba(20,20,20,0.8);border:1px solid #AAA;padding:5px;white-space:nowrap}#menu{border-radius:3px}#menu div{text-shadow:2px 2px 2px #000;border-radius:2px;padding:4px 10px;margin:1px 0;transition:0.3s}#menu div:hover{background-color:#d63;cursor:pointer;transition:0s}#info_tab{display:block;width:300px;padding:10px;top:10px;right:10px;margin-right:-400px;transition:0.3s}#info_tab table{width:100%;margin-top:20px}#info_tab table input{width:80%;margin-left:5%}.titles{color:#d62;font-size:16px}.right_aligned{text-align:right;width:150px}#fix_lot:disabled,#monthly_payout_percent:disabled{background-color:#222;color:#777}#mini_map{display:block;right:10px;bottom:10px}</style>
</head>
<body>
<div id="create_layer"></div>
<div id="progress_bar"></div>
<div id="start_page">
<div id="left_table">
<textarea id="report_result" wrap="off" spellcheck="false" onclick="setTimeout(function() { elem('report_result').select() }, 20)" onkeyup="this.select()" onfocus="default_value(this, 'Jelentés...')" onblur="default_value(this, 'Jelentés...')">Jelentés...</textarea>
<table id="report_name_table" border="0" cellpadding="0" cellspacing="0"><tr>
<td width="300"><input type="text" id="report_name" value="Jelentés neve..." spellcheck="false" onfocus="default_value(this, 'Jelentés neve...')" onblur="default_value(this, 'Jelentés neve...')"></td>
<td class="button" style="margin-left: 5px;" onclick="add_report()">Hozzáadás</td>
</tr></table>
<div id="strategies"></div>
</div>
<div id="right_table">
<span class="titles" style="font-size: 20px;">MetaTrader Jelentés Egyesítő</span><br><br><br>
Futtatsd le a backtest-et MT-ben, <span class="hw">FIX 0.1 Lot</span>-tal!<br>
A Jelentést el kell menteni HTML-ként. Ha megnyílt a böngészőben, akkor másold ki az egészet (<span class="hw">Ctrl + A</span> majd <span class="hw">Ctrl + C</span>) és illeszd be (<span class="hw">Ctrl + V</span>) a baloldali szöveg mezőbe. Elméletileg korlátlan mennyiségű jelentést adhatsz hozzá.<br><br>
Grafikonra váltás után, vidd a kurzor-nyilat a képernyő jobb szélére és előjön az összesítő panel. A grafikon először napi bontásban mutatja a profitot, de a jobb-klikk menüből válthatsz egyenlegre, és/vagy kereskedésre is.<br><br>
<div class="button" id="more_info_button" onclick="show_info()">További infó</div><br><br>
<div id="more_info">
<div id="shadow"></div>
<span class="titles">Dinamikus Lot számítása:</span><br><br>
<div style="margin-left: 20px;">
Balance/Lot vagyis a megadott egyenlegnél lesz 1 Lot-os kötésméret.<br>
Pl. ha 10 000, akkor 5 000 $-on lesz 0.5 Lot.<br><br>
Bár az én robotomba is ilyen opciót írtam, mégis van kisebb különbség a profitban. Van, hogy többet mutat, néha kevesebbet. Ezt nem tudom kijavítani.<br>
Az MT4 Jelentésből hiányzik az éjféli kamat, valószínüleg ez az oka.<br>
MT5-ben benne van, viszont ez másodperces pontossággal rendezi a pozíciókat, itt emiatt lehet az eltérés.<br><br>
</div>
<span class="titles">Kiutalások:</span><br><br>
<div style="margin-left: 20px;">
A kiutalásokat minden hónap elsején levonja a teljes egyenlegből.<br>
Dinamikus Lot-nál a profit kevesebb lesz, hiszen a Lot méretet az egyenleghez igazítja.<br><br>
</div>
<span class="titles">Visszaesés:</span><br><br>
<div style="margin-left: 20px;">
Ha fix Lot van beállítva, akkor pénzben <span class="hw">($)</span> mutatja a legnagyobb visszaesést.<br>
Dinamikus Lot-nál, százalékban <span class="hw">(%)</span>. Ilyenkor beleszámolja a teljes egyenleget.<br>
Mindig kevesebbet mutat, mint az MT4! Mivel ez utóbbi figyeli, ha egy nyitott pozíció elmegy minuszba de később visszafordul és pluszban zárul. Míg ez, és más merger csak a zárt pozíciókat számolja.<br>
MT5 Jelentésénél külön vannak ilyen és olyan adatok. Ha ott is a "drawdown" adatokat nézed, akkor nincs eltérés.<br>
További fontosság, hogy mást mutat, ha kereskedésben nézed a grafikont. Ilyenkor egyenként figyeli a veszteséges pozíciókat.<br>Egy példa: Egy napon zárultak: <span class="hw">+200, -100, -100</span>.<br>
Kereskedésben ez -200 $ de napok szerint 0 lesz.<br><br>
</div>
<span class="titles">Hogyan működik?</span><br><br>
<div style="margin-left: 20px;">
1.) A hozzáadott Jelentések zárult kereskedéseit perces pontossággal sorrendbe állítja, amikor a Grafikon gombra nyomsz. Emiatt 10 éves tesztek összeállítása akár 8-10 pásodpercig is eltarthat. Ez a kereskedések számától is függ.<br><br>
2.) Az új eredmény listáról minden alkalommal (amikor a grafikonon változtatsz valamit) készít egy új, összesített jelentést.<br><br>
</div>
<span class="titles">Teljesítmény:</span><br><br>
<div style="margin-left: 20px;">
A számítási időket láthatod a böngésző konzolban.<br><br>
Ajánlott a Chrome vagy Firefox böngészők használata a nagyobb teljesítményük miatt. Microsoft böngészők (Explorer, Edge) nagyon gyengék, ezeknél a jelentés összeállítása kb. 54x tovább tart, mint a fent említett kettőnél.<br><br>
</div>
<span class="titles">About:</span><br><br>
<div style="margin-left: 20px;">
Készítette: Reich István, 2018<br><br>
Build: 3.04.07
</div>
</div>
</div>
</div>
<div id="chart_page" onclick="show_menu()">
<div id="chart" class="chart_divs"></div>
<div class="chart_divs">
<svg id="zoom_rect"><rect width="100%" height="100%"></svg>
<svg id="dd_rect"><rect width="100%" height="100%"></svg>
</div>
<svg id="point_marker" height="20" width="20"><circle cx="10" cy="10" r="4"></svg>
<div style="position: absolute; width: 100%; height: 100%; background-color: rgba(0,0,0,0); text-align: center;">
<div id="zoom_reset_text" class="tabs" style="position: relative; margin-top: 60vh;">Nagyítás visszaállítása</div>
</div>
<div id="mini_map" class="tabs">
<table width="200" cellpadding="5" cellspacing="0">
<tr><td><span id="mini_map_level">Profit:</span></td><td id="profit_level" class="right_aligned">0</td></tr>
<tr><td>Dátum:</td><td id="profit_date" class="right_aligned">0</td></tr>
</table>
</div>
<div id="info_tab" class="tabs">
<span class="titles">Tőke Felügyelet:</span>
<table cellpadding="3" cellspacing="0" style="padding-bottom: 20px;">
<tr><td title="Kezdő egyenleg pénzben.">Kezdő egyenleg: ($)</td><td class="right_aligned"><input type="text" id="start_balance" spellcheck="false" value="100 000" onclick="this.select()" onkeyup="re_space(this, this.value)" onblur="create_full_report()"></td></tr>
<tr><td title="Dinamikus Lot.&#013;Ekkora egyenlegnél lesz 1 Lot.&#013;Ha az értéke nagyobb, mint 0,&#013;akkor az Állandó Lot tiltott.">Egyenleg / Lot:</td><td class="right_aligned"><input type="text" id="balance_per_lot" spellcheck="false" value="0" onclick="this.select()" onkeyup="re_space(this, this.value)" onblur="create_full_report()"></td></tr>
<tr><td title="Minden kereskedésre ekkora Lot.">Állandó Lot:</td><td class="right_aligned"><input type="text" id="fix_lot" spellcheck="false" value="0.1" onclick="this.select()" onblur="create_full_report()"></td></tr>
<tr><td title="Állandó havi kiutalás.&#013;Ha az értéke nagyobb, mint 0,&#013;akkor az Arányos kiutalás tiltott">Havi kiutalás: ($)</td><td class="right_aligned"><input type="text" id="monthly_payout_fix" spellcheck="false" value="0" onclick="this.select()" onkeyup="re_space(this, this.value)" onblur="create_full_report()"></td></tr>
<tr><td title="Arányos havi kiutalás.&#013;Az egyenleg ennyi százaléka.">Havi kiutalás: (%)</td><td class="right_aligned"><input type="text" id="monthly_payout_percent" spellcheck="false" value="0" onclick="this.select()" onblur="create_full_report()"></td></tr>
</table>
<span class="titles">Összevont Jelentés:</span>
<table cellpadding="3" cellspacing="0">
<tr><td style="color: #38D">Vég egyenleg:</td><td style="color: #38D" id="full_balance" class="right_aligned">0</td></tr>
<tr><td style="color: #DA6">Összes kiutalás:</td><td style="color: #DA6" id="full_payout" class="right_aligned">0</td></tr>
<tr><td style="color: #7B5">Nettó profit:</td><td style="color: #7B5" id="net_profit" class="right_aligned">0</td></tr>
<tr><td style="color: #E54" id="max_dd">Max. visszaesés: ($)</td><td style="color: #E54" id="drawdown" class="right_aligned">0</td></tr>
<tr><td>Profit / visszaesés:</td><td id="profit_per_dd" class="right_aligned">0</td></tr>
<tr><td>Profit factor:</td><td id="profit_factor" class="right_aligned">0</td></tr>
<tr><td id="trades_days_text">Összes nap:</td><td id="full_trades_days" class="right_aligned">0</td></tr>
</table>
</div>
<div id="menu" class="tabs">
<div onclick="change_chart_type()" id="chart_type">Egyenleg grafikon</div>
<div onclick="change_mod()" id="mode_in_menu">Kereskedés szerint</div>
<hr style="height: 0; margin: 5px; border-style: solid; border-color: #AAA;">
<div onclick="show_trend_line()">Trend vonal</div>
<div onclick="show_dd(true)">Visszaesés</div>
</div>
</div>
<div class="button" id="page_changer" onclick="change_page()">Grafikon</div>
<script type="text/javascript">window.g={all_reports:{},enabled_reports:"",clean_reports:[],full_date:[],full_s_date:'',full_e_date:'',show_in_trades:false,chart_in_profit:true,trend_line_display:'none',svg_poly_points:'',svg_marker_point:[],dd:[0,0],profit_level:[],zoom_rect_margin:0,power:{},timer:0,selection:{"onclick":false,"timer":false},selected_date:{"start":"","end":""},current_date:'',ck:window.document.cookie,local_date:new Date().getDate().toString(),chart:document.getElementById('chart_page')};if((g.ck.indexOf("Refresh_page")>-1)&&(g.ck.split("Refresh_page=")[1].split(';')[0]!=g.local_date)){setTimeout(function(){window.location.reload(true)},64);window.document.cookie="Refresh_page="+g.local_date+";expires=Thu, 01 Jan 2100 00:00:01 GMT;"};window.onresize=function(){if(elem('chart_page').style.display=='block')create_full_report()};function elem(id){return document.getElementById(id)};function elem_style(id,attr){return parseInt(window.getComputedStyle(elem(id)).getPropertyValue(attr))};function puts(text){return console.log(text)};function power(id,pretext,posttext){if(!pretext&&!posttext)return g.power[id]=new Date().getTime();console.log(pretext+String((new Date().getTime()-g.power[id])/1000)+posttext)};function double_number(d){return String("0"+(d)).slice(-2)};function splitted_float(num){var parts=rounded(num).toString().split("\.");parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g," ");return parts.join("\.")};function re_space(e,val){val=val.replace(/\ |\,|\./g,'');e.value=val.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")};function default_value(e,value){if(e.value==value)e.value='';else if(e.value=='')e.value=value};document.addEventListener('contextmenu',function(cursor){cursor.preventDefault();if(elem('chart_page').style.display=='block')show_menu(cursor)},false);function arrow(state){var s=10;var svg='',f=(s/2),points={"up":'0,'+s+' '+f+',0 '+s+','+s,"down":'0,0 '+f+','+s+' '+s+',0',"left":s+',0 0,'+f+' '+s+','+s,"right":'0,'+s+' 0,0 '+s+','+f};svg+='<svg height="'+s+'" width="'+s+'" style="position: relative; margin-'+((state=="left")?'right':'left')+': 6px; filter: drop-shadow(2px 2px 1px #111);">';svg+='<polygon points="'+points[state]+'" style="fill: #DDD; stroke: none;"></svg>';return svg};function rounded(num){return Math.round((num)*100)/100};elem('page_changer').innerHTML+=arrow("right");elem('more_info_button').innerHTML+=arrow("down");g.chart.onmouseout=function(){elem('point_marker').style.display='none'};g.chart.onmousemove=function(cursor){w=elem_style('info_tab','width')+30;h=elem_style('info_tab','height')+30;if((cursor.pageX>=(window.innerWidth-4))&&(cursor.pageY<h)){elem('info_tab').style.marginRight='0px'};if(((window.innerWidth-cursor.pageX)>w)||(cursor.pageY>h)){elem('info_tab').style.marginRight='-400px'};if(g.svg_marker_point.length>0){var gm=11,x=0,y=0,pm=elem('point_marker'),zr=elem('zoom_rect');for(var i=0;i<(g.svg_marker_point.length-1);i++){x=parseInt(g.svg_marker_point[i].split(',')[0]);y=parseInt(g.svg_marker_point[i].split(',')[1]);if(((cursor.pageX-gm)>(x-3))&&((cursor.pageX-gm)<(x+3))){x+=1;y+=1;if(pm.style.display!='block')pm.style.display='block';pm.style.margin=String(y)+'px '+String(x)+'px';elem('profit_level').innerHTML=splitted_float(g.profit_level[i][0]);elem('profit_date').innerHTML=g.profit_level[i][1];var date=g.profit_level[i][1].replace(/\./g,"-");g.current_date=date.slice(0,date.length-1);if(g.selection["onclick"]){if(g.zoom_rect_margin==0){zr.style.marginLeft=String(x)+'px';g.zoom_rect_margin=x};if(x>g.zoom_rect_margin){zr.style.width=String(x-g.zoom_rect_margin)+'px';if(g.selection["timer"])elem('zoom_reset_text').style.display='none'}else{zr.style.width='0px';if(g.selection["timer"])elem('zoom_reset_text').style.display='inline-block'}}}}}};g.chart.onmousedown=function(e){if((e.which!=1)||(g.enabled_reports==""))return;g.selection["onclick"]=true;g.selected_date["start"]=g.current_date;g.timer=setTimeout(function(){elem('zoom_rect').style.display='block';elem('zoom_rect').style.height=elem_style('chart_page','height')+'px';if(elem_style('zoom_rect','width')<1)elem('zoom_reset_text').style.display='inline-block';g.selection["timer"]=true},200)};g.chart.onmouseup=function(e){if((e.which!=1)||(g.enabled_reports==""))return;if(g.selection["timer"]){g.selected_date["end"]=g.current_date;var s=new Date(g.selected_date["start"]);var e=new Date(g.selected_date["end"]);if(s<e)g.full_date=[s,e];else g.full_date=[g.full_s_date,g.full_e_date];elem('zoom_rect').style.display='none';elem('zoom_reset_text').style.display='none';create_full_report()};clearTimeout(g.timer);g.selection["onclick"]=false;g.selection["timer"]=false;g.selected_date["start"]="";g.selected_date["end"]="";g.zoom_rect_margin=0;elem('zoom_rect').style.width='0px'};function show_menu(cursor){var e=elem('menu');if(cursor&&(e.style.display!='block')){e.style.marginLeft=cursor.pageX+'px';e.style.marginTop=cursor.pageY+'px';e.style.display='block'}else{e.style.display='none'}};function show_info(hidden){var e=elem('more_info');if(hidden||(e.style.height=='auto')){elem('shadow').style.display='block';elem('more_info_button').innerHTML="További infó"+arrow("down");e.style.height='50px'}else if(e.style.height!='auto'){elem('shadow').style.display='none';elem('more_info_button').innerHTML="További infó"+arrow("up");e.style.height='auto'}};function show_trend_line(){if(g.enabled_reports=="")return;var e=elem('trend_line');e.style.display=(e.style.display!='block'?'block':'none');g.trend_line_display=e.style.display};function show_dd(toggle){var r=elem('dd_rect');if(toggle)r.style.display=((r.style.display!='block')?'block':'none');r.style.width=(g.dd[1]-g.dd[0])+'px';r.style.height=elem_style('chart_page','height')+'px';r.style.marginLeft=(g.dd[0]+1)+'px'};function change_page(){if(elem('start_page').style.display!='none'){show_info(true);elem('create_layer').style.display='block';elem('progress_bar').style.display='block';merge_strategies()}else{elem('chart_page').style.display='none';elem('menu').style.display='none';elem('page_changer').innerHTML="Grafikon"+arrow("right");elem('start_page').style.display='block'}};function change_mod(){if(g.show_in_trades){elem('mode_in_menu').innerHTML="Kereskedés szerint";g.show_in_trades=false}else{elem('mode_in_menu').innerHTML="Napok szerint";g.show_in_trades=true};g.full_date=[g.full_s_date,g.full_e_date];create_full_report()};function change_chart_type(){if(g.chart_in_profit){elem('chart_type').innerHTML="Profit grafikon";elem('mini_map_level').innerHTML="Egyenleg:";g.chart_in_profit=false}else{elem('chart_type').innerHTML="Egyenleg grafikon";elem('mini_map_level').innerHTML="Profit:";g.chart_in_profit=true};create_full_report()};function add_years_separators(left,year,height){var divs='<div style="position: relative"><div class="chart_years" style="margin-left: '+left+'px;">'+year+'</div>';divs+='<div class="chart_separators" style="margin-left: '+left+'px; height: '+height+'px;"></div></div>';return divs};function add_report(){var name=elem('report_name').value;var result=elem('report_result').value;var rows=[],row='',mt_ver='',report='';var report_rows=result.split("\n");if((name!="Jelentés neve...")&&(result!="Jelentés...")){for(var i=0;i<report_rows.length;i++){if((report_rows[i].indexOf("Profit")>-1)&&(report_rows[i].indexOf("Egyenleg")>-1)){row=report_rows[i];mt_ver='4'}else if((report_rows[i].indexOf("Egyenleg")>-1)&&(report_rows[i].indexOf("Megjegyzés")>-1)){row=report_rows[i];mt_ver='5'}};if(mt_ver=='4'){report=result.split(row)[1];rows=report.split("\n");rows=rows.slice(1,rows.length);report='';for(var i=0;i<rows.length;i++){tabs=rows[i].split("\t");date=tabs[1];value=(tabs[8]?tabs[8].replace(/\ /g,""):'0.00');report+=date+','+value+'|'}};if(mt_ver=='5'){report=result.split(row)[1];rows=report.split("\n");rows=rows.slice(2,rows.length-2);report='';for(var i=0;i<rows.length;i++){tabs=rows[i].split("\t");date=tabs[0].split(':')[0]+':'+tabs[0].split(':')[1];value=((tabs[10]!='0.00')?String(parseFloat(tabs[9].replace(/\ /g,""))+parseFloat(tabs[10].replace(/\ /g,""))):'0.00');report+=date+','+value+'|'}};if(!g.all_reports[name]){var strat='<table id="strategy_'+name+'" class="strategy_buttons" cellspacing="0" cellpadding="0"><tr>';strat+='<td width="20" class="button remove_buttons" onclick="delete_strategy(\''+name+'\')" title="Törlés">✖</td>';strat+='<td width="235">'+name+'</td>';strat+='<td width="50" class="hw" title="MetaTrader verzió">MT'+mt_ver+'</td>';strat+='<td width="20" class="button checkbox" id="checkbox_'+name+'" onclick="enable_strategy(\''+name+'\')" title="Engedélyezés / Tiltás">✔</td>';strat+='</tr></table>';elem('strategies').innerHTML+=strat;g.all_reports[name]=report}else{alert("Már van ilyen név!")};elem('report_name').value="Jelentés neve...";elem('report_result').value="Jelentés..."}};function delete_strategy(name){if(!confirm("Biztos, hogy törlöd?"))return;delete g.all_reports[name];var e=elem('strategy_'+name);e.outerHTML="";delete e;elem('report_name').value="Jelentés neve...";elem('report_result').value="Jelentés..."};function enable_strategy(name){elem('report_name').value="Jelentés neve...";elem('report_result').value="Jelentés...";var cb=elem('checkbox_'+name);cb.innerHTML=((cb.innerHTML=="✔")?"&nbsp;":"✔")};function merge_strategies(){power("merge");g.enabled_reports="";var start_year=9999,end_year=0;var start_date=new Date("2038-01-01"),end_date=new Date("2000-01-01");var checkbox=elem('strategies').getElementsByTagName('td');for(var i=0;i<checkbox.length;i++){if(checkbox[i].id.indexOf('checkbox')>-1){if(checkbox[i].innerHTML=="✔"){name=checkbox[i].id.split("_")[1];res=g.all_reports[name];splitted_date=res.split(' ')[0];first_year=parseInt(splitted_date.split('.')[0]);if(first_year<start_year)start_year=first_year;first_date=new Date(splitted_date.replace(/\./g,"-"));if(first_date<start_date)start_date=first_date;splitted_date=res.split('|').slice(-2)[0].split(' ')[0];last_year=parseInt(splitted_date.split('.')[0]);if(last_year>end_year)end_year=last_year;last_date=new Date(splitted_date.replace(/\./g,"-"));if(last_date>end_date)end_date=last_date;g.enabled_reports+=res}}};var results_by_date={};var rows=g.enabled_reports.split('|');for(var i=0;i<(rows.length-1);i++){s=rows[i].split(',');if(!results_by_date[s[0]]){results_by_date[s[0]]=s[1]+'|'}else{results_by_date[s[0]]+=s[1]+'|'}};g.clean_reports=[];g.full_s_date=start_date;g.full_e_date=end_date;g.full_date=[g.full_s_date,g.full_e_date];var month_counter=1,rows_length=rows.length,row_counter=0,v='',d='';var year=0,month=0,day=0,h=0,m=0,i=0;(function merge(){for(year=start_year;year<=end_year;year++){for(month=month_counter;month<=12;month++){for(day=1;day<=31;day++){for(h=0;h<24;h++){for(m=0;m<60;m++){d=(year+'.'+double_number(month)+'.'+double_number(day)+' '+double_number(h)+':'+double_number(m));if(results_by_date[d]){v=results_by_date[d].split('|');for(i=0;i<(v.length-1);i++){row_counter++;g.clean_reports.push([d,v[i]])}};if((day==1)&&(h==0)&&(m==0))g.clean_reports.push([d,"payout"])}}};percent=Math.round((row_counter/rows_length)*100).toString();elem('create_layer').innerHTML='<div id="new_list">Új lista összeállítása: '+percent+'%</div>';elem('progress_bar').style.width=((window.innerWidth/100)*percent)+'px';if(start_year<=end_year){if(month==12){start_year++;month_counter=1}else month_counter++;return setTimeout(merge,10)}}};elem('progress_bar').style.display='none';elem('chart_page').style.display='block';elem('page_changer').innerHTML=arrow("left")+"Vissza";elem('create_layer').style.display='none';elem('start_page').style.display='none';power("merge","---------------\nÚj, összesített lista\nszámítási ideje: "," mp");power("report");create_full_report();power("report","---------------\nJelentés ideje\n"+(g.show_in_trades?"kereskedésben: ":"napokban: ")," mp")})()};function create_full_report(){g.svg_poly_points='';g.svg_marker_point=[];g.profit_level=[];g.dd=[0,0];elem('fix_lot').disabled=(elem('balance_per_lot').value!='0');elem('monthly_payout_percent').disabled=(elem('monthly_payout_fix').value!='0');if(g.enabled_reports=="")return clean_up();var start_balance=parseInt(elem('start_balance').value.replace(/\ /g,'')),balance_per_lot=parseInt(elem('balance_per_lot').value.replace(/\ /g,'')),fix_lot=parseFloat(elem('fix_lot').value);var full_balance=start_balance,monthly_payout_fix=parseInt(elem('monthly_payout_fix').value.replace(/\ /g,'')),monthly_payout_percent=parseFloat(elem('monthly_payout_percent').value);var profit=0,new_profit=0,dynamic_profit=0,static_profit=0,lot=0,lot_change_enabled=true;var day_ms=86400000,trade_counter=0,full_payout=0,trading_ticks={},total_ticks=0,gross_loss=0,gross_profit=0;var date='',days='',value='',result_date='',first_trading_day=g.full_date[0],last_trading_day=g.full_date[1];if(monthly_payout_percent>100)monthly_payout_percent=100;if(monthly_payout_fix>start_balance)monthly_payout_fix=start_balance;g.clean_reports.forEach(function(datas,index){date=datas[0];value=datas[1];days=date.split(' ')[0];result_date=new Date(days.replace(/\./g,"-"));if((result_date>=g.full_date[0])&&(result_date<=g.full_date[1])){if(value.indexOf("payout")>-1){if(full_balance>10){if(monthly_payout_fix>0){payout=monthly_payout_fix}else{payout=((monthly_payout_percent*0.01)*full_balance)};full_payout+=payout;full_balance-=payout};if(full_balance<=10){full_payout+=full_balance;full_balance=0}}else{if(value=='0.00')lot_change_enabled=true;else{if(full_balance>10){profit=parseFloat(value);if(lot_change_enabled)lot=rounded(((balance_per_lot>0)?(full_balance/balance_per_lot):fix_lot)*10);new_profit=rounded(profit*lot);((profit<0)?(gross_loss+=new_profit):(gross_profit+=new_profit));full_balance+=new_profit;full_balance=rounded(full_balance);dynamic_profit+=new_profit;dynamic_profit=rounded(dynamic_profit);static_profit+=rounded(profit);static_profit=rounded(static_profit)};if(g.show_in_trades)trading_ticks[String(trade_counter)]=[dynamic_profit,static_profit,full_balance,days];trade_counter+=1;lot_change_enabled=false}};if(!g.show_in_trades){day_counter=Math.round((Date.parse(result_date)-Date.parse(first_trading_day))/day_ms);trading_ticks[String(day_counter)]=[dynamic_profit,static_profit,full_balance]}}});if(g.show_in_trades)total_ticks=trade_counter+10;else total_ticks=Math.round((Date.parse(last_trading_day)-Date.parse(first_trading_day))/day_ms)+11;var profit_balance=0,d_profit=0,s_profit=0,f_balance=0,highest_balance=0,highest=0,lowest=0,s_highest=0,d_highest=0,dd_start=0,dd_end=0,drawdown=0,drn=0;for(var tick=0;tick<=total_ticks;tick++){if(trading_ticks[String(tick)]){data=trading_ticks[String(tick)];profit_balance=(g.chart_in_profit?data[0]:data[2]);d_profit=data[0];s_profit=data[1];f_balance=data[2];if(profit_balance>highest)highest=profit_balance;if(profit_balance<lowest)lowest=profit_balance;if(s_profit>s_highest){highest_balance=f_balance;d_highest=d_profit;s_highest=s_profit}else if((s_highest-s_profit)>drn){dd_start=s_highest;dd_end=s_profit;if(elem('fix_lot').disabled)drawdown=rounded(100-((f_balance/highest_balance)*100));else drawdown=rounded(d_highest-d_profit);drn=(s_highest-s_profit)}}};var chart_width=elem_style('chart','width');var chart_height=elem_style('chart','height');var chart_inner_height=(chart_height*0.9),margin=((chart_height-chart_inner_height)/2);var profit_balance=0,f_balance=0,margin_left=0,date_by_tick,separators='',date_by_trade='';for(var tick=-1;tick<=total_ticks;tick++){if(!g.show_in_trades){date_by_tick=new Date(Date.parse(first_trading_day)+(tick*day_ms));m=date_by_tick.getMonth();d=date_by_tick.getDate();if((m==0)&&(d==1))separators+=add_years_separators(margin_left,date_by_tick.getFullYear(),chart_height)};x=Math.round(margin_left);if(g.show_in_trades){if(tick<(total_ticks-1))margin_left+=(chart_width/(total_ticks-10))}else margin_left+=((chart_width-1)/(total_ticks-10));if(trading_ticks[String(tick)]){data=trading_ticks[String(tick)];profit_balance=(g.chart_in_profit?data[0]:data[2]);if(g.show_in_trades)date_by_trade=data[3]};rate=chart_inner_height/(highest-lowest);y=Math.round((lowest*rate)+((highest-profit_balance-lowest)*rate)+margin);if(!y)y=(chart_height/2);g.svg_poly_points+=x+','+y+' ';if(tick<(total_ticks-10)){if(data[1]==dd_start)g.dd[0]=x;if(data[1]==dd_end)g.dd[1]=x;if(g.show_in_trades){g.profit_level.push([profit_balance,date_by_trade+'.'])}else{g.profit_level.push([profit_balance,date_by_tick.toLocaleDateString().replace(/\ /g,"")])}}};var splitted=g.svg_poly_points.split(' ');g.svg_marker_point=splitted.slice(0,splitted.length-11);var right_bottom=splitted.slice(-2)[0].split("\,")[0]+','+splitted[0].split("\,")[1];var svg_poly_line='<svg width="'+chart_width+'" height="'+chart_height+'">';svg_poly_line+='<polyline style="stroke: '+(g.chart_in_profit?'#4B6':'#28D')+'; fill: rgba(50,50,50,'+(g.chart_in_profit?'0':'0.2')+');" points="'+g.svg_poly_points+' '+right_bottom+'"></svg>';var svg_trend_line='<svg width="'+chart_width+'" height="'+chart_height+'" id="trend_line" style="display: '+g.trend_line_display+'">';svg_trend_line+='<polyline style="stroke: #D72" points="'+(g.chart_in_profit?splitted[0]:splitted[1])+' '+g.svg_marker_point.slice(-2)[0]+'"></svg>';var svg_zero_line='<svg width="'+chart_width+'" height="'+chart_height+'">';svg_zero_line+='<polyline style="stroke: '+(g.chart_in_profit?'none':'#D31')+'" points="'+splitted[0]+' '+right_bottom+'"></svg>';elem('chart').innerHTML=separators+svg_poly_line+svg_trend_line+svg_zero_line;show_dd();elem('full_balance').innerHTML=splitted_float(full_balance);elem('full_payout').innerHTML=splitted_float(full_payout);elem('net_profit').innerHTML=splitted_float(dynamic_profit);elem('max_dd').innerHTML="Max. visszaesés: "+((elem('fix_lot').disabled)?"(%)":"($)");elem('drawdown').innerHTML=splitted_float(drawdown);elem('profit_per_dd').innerHTML=(drawdown>0?rounded(dynamic_profit/drawdown):"~");elem('profit_factor').innerHTML=(gross_loss<0?-rounded(gross_profit/gross_loss):"~");elem('full_trades_days').innerHTML=splitted_float((g.show_in_trades)?total_ticks-10:total_ticks-11);elem('trades_days_text').innerHTML=((g.show_in_trades)?"Összes kereskedés:":"Összes nap:");elem('point_marker').style.display='none'};function clean_up(){elem('point_marker').style.display='none';elem('start_balance').value='100 000';elem('chart').innerHTML="";elem('profit_level').innerHTML="0";elem('profit_date').innerHTML="0";elem('net_profit').innerHTML="0";elem('profit_per_dd').innerHTML="0";elem('drawdown').innerHTML="0";elem('profit_factor').innerHTML="0";elem('full_trades_days').innerHTML="0";elem('full_balance').innerHTML="0";elem('full_payout').innerHTML="0"};</script>
</body>
</html>

